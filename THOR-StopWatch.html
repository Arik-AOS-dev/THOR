<!DOCTYPE html>
<!smccaffr 20260108>
<html>
<head>
    <title>THOR 2026 Stop Watch (v1)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f3f3f3;
        }
       #version {
        position: absolute;
        top: 10px;
        right: 10px;
        font-size: 12px;
        color: #999;
       }
        #container {
            max-width: 400px;
            margin: 20px auto;
            padding: 10px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        button {
            display: block;
            width: 100%;
            margin: 10px 0;
            padding: 15px;
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        button:disabled {
            background-color: #000;
            color: gold;
            opacity: 0.7;
            cursor: not-allowed;
        }

        button#recordTimeButton {
            background-color: #28a745;
            font-size: 36px;
            padding: 30px;
        }

        button#downloadButton {
            background-color: #17a2b8;
            font-size: 16px;
            padding: 12px;
            margin: 10px 0;
            width: auto;
            float: right;
        }

        #timeList {
            margin-top: 20px;
            clear: both;
        }

        .timeEntry {
            background-color: #f9f9f9;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .timeEntry input[type="text"] {
            width: 100px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
        }

        .timeEntry span {
            font-size: 20px;
            color: #333;
            font-family: monospace;
        }
    </style>
</head>
<body>
  <div id="container">
        <button id="downloadButton" onclick="saveAndDownload()">Download</button>
        <button id="startFinishToggle" onclick="toggleStartFinish()">THOR 2026 Start Line (v11)</button>
        <button id="recordTimeButton" onclick="recordTime()">Record Time</button>
        <div id="latestTime" style="text-align: center; font-size: 48px; font-family: monospace;">00:00:00.000</div>
        <div id="timeList"></div>
    </div>

    <script>
        let times = [];
        let startFinishType = 'Start';
        let recordingStarted = false;

        function toggleStartFinish() {
            const toggleButton = document.getElementById('startFinishToggle');
            if (!recordingStarted) {
                if (startFinishType === 'Start') {
                    startFinishType = 'Finish';
                    toggleButton.textContent = 'THOR 2026 Finish Line (v11)';
                } else {
                    startFinishType = 'Start';
                    toggleButton.textContent = 'THOR 2026 Start Line (v11)';
                }
            }
        }

        function recordTime() {
            recordingStarted = true;
            document.getElementById('startFinishToggle').disabled = true;
            
            const currentTime = new Date();
            const ms = currentTime.getMilliseconds().toString().padStart(3, '0');
            const formattedTime = `${currentTime.getHours().toString().padStart(2, '0')}:${currentTime.getMinutes().toString().padStart(2, '0')}:${currentTime.getSeconds().toString().padStart(2, '0')}.${ms}`;

            document.getElementById('latestTime').textContent = formattedTime;

            // Push to data array
            const index = times.length;
            times.push({ time: formattedTime });

            // Build UI
            const timeEntry = document.createElement('div');
            timeEntry.classList.add('timeEntry');

            const spanElement = document.createElement('span');
            spanElement.textContent = formattedTime;

            const inputElement = document.createElement('input');
            inputElement.type = 'text';
            inputElement.id = `textBox_${index}`;
            inputElement.placeholder = "Crew #";

            timeEntry.appendChild(spanElement);
            timeEntry.appendChild(inputElement);
            document.getElementById('timeList').prepend(timeEntry);
        }

        window.onbeforeunload = function() {
            if(recordingStarted) return "You have unsaved data!";
        };

        function saveAndDownload() {
            if (times.length === 0) return alert("No times recorded yet.");

            let csvContent = "data:text/csv;charset=utf-8,";
            const timeTitle = startFinishType === 'Start' ? 'Start Time' : 'Finish Time';
            const crewTitle = startFinishType === 'Start' ? 'Start Crew' : 'Finish Crew';
            
            csvContent += `${timeTitle},${crewTitle}\n`;

            times.forEach((entry, index) => {
                const input = document.getElementById(`textBox_${index}`);
                const crewValue = input ? input.value : "";
                csvContent += `${entry.time},${crewValue}\n`;
            });

            const timestamp = new Date().toISOString().replace(/:/g, '-').split('.')[0];
            const filename = `THOR26_${startFinishType}_${timestamp}.csv`;

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", filename);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>
</html>
